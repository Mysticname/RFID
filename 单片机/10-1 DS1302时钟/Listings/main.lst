C51 COMPILER V9.53.0.0   MAIN                                                              06/19/2025 17:52:34 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\Keli_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "LCD1602.h"
   3          #include "DS1302.h"
*** WARNING C318 IN LINE 1 OF DS1302.h: can't open file 'config.h'
   4          
   5          // 定义倒计时时间（20分钟）
   6          #define COUNTDOWN_MINUTES 20
   7          
   8          // 倒计时结束标志
   9          bit countdownFinished = 0;
  10          
  11          // 倒计时开始时间（存储为秒）
  12          unsigned long startTime = 0;
  13          
  14          /**
  15            * @brief  获取当前时间总秒数
  16            * @param  无
  17            * @retval 当前时间的总秒数
  18            */
  19          unsigned long GetCurrentTimeInSeconds()
  20          {
  21   1          DS1302_ReadTime(); // 读取当前时间
  22   1          // 计算从00:00:00开始的秒数
  23   1          return (unsigned long)DS1302_Time[3] * 3600UL + 
  24   1                 (unsigned long)DS1302_Time[4] * 60UL + 
  25   1                 (unsigned long)DS1302_Time[5];
  26   1      }
  27          
  28          /**
  29            * @brief  设置倒计时开始时间
  30            * @param  无
  31            * @retval 无
  32            */
  33          void StartCountdown()
  34          {
  35   1          // 设置DS1302时间为0时0分0秒
  36   1          DS1302_Time[3] = 0; // 小时
  37   1          DS1302_Time[4] = 0; // 分钟
  38   1          DS1302_Time[5] = 0; // 秒钟
  39   1          DS1302_SetTime();   // 写入DS1302
  40   1          
  41   1          // 记录开始时间（0秒）
  42   1          startTime = 0;
  43   1      }
  44          
  45          /**
  46            * @brief  主函数
  47            * @param  无
  48            * @retval 无
  49            */
  50          void main()
  51          {
  52   1          LCD_Init();         // 初始化LCD
  53   1          DS1302_Init();      // 初始化DS1302
C51 COMPILER V9.53.0.0   MAIN                                                              06/19/2025 17:52:34 PAGE 2   

  54   1          
  55   1          // 显示静态字符
  56   1          LCD_ShowString(1,1,"CountDown: ");
  57   1          LCD_ShowString(2,1,"  :  ");  // 预留时间显示位置
  58   1          
  59   1          // 启动倒计时
  60   1          StartCountdown();
  61   1          
  62   1          while(1)
  63   1          {
  64   2              // 获取当前时间（从开始计时起的秒数）
  65   2              unsigned long currentTime = GetCurrentTimeInSeconds();
  66   2              
  67   2              // 计算已过去的时间（秒）
  68   2              unsigned long elapsedTime = currentTime - startTime;
  69   2              
  70   2              // 计算剩余时间（秒）
  71   2              unsigned long remainingTime = COUNTDOWN_MINUTES * 60 - elapsedTime;
  72   2            
  73   2               // 计算分钟和秒数
  74   2              unsigned char minutes = (unsigned char)(remainingTime / 60);
  75   2              unsigned char seconds = (unsigned char)(remainingTime % 60);
  76   2            
  77   2              // 检查是否倒计时结束
  78   2              if (remainingTime <= 0)
  79   2              {
  80   3                  countdownFinished = 1;
  81   3                  remainingTime = 0; // 确保不为负值
  82   3              }
  83   2              
  84   2             
  85   2              
  86   2              // 显示倒计时时间
  87   2              LCD_ShowNum(2,1,minutes,2); // 显示分钟
  88   2              LCD_ShowNum(2,4,seconds,2); // 显示秒钟
  89   2              
  90   2              // 如果倒计时结束，显示完成信息
  91   2              if (countdownFinished)
  92   2              {
  93   3                  LCD_ShowString(1,1,"CountDown Finish!");
  94   3                  // 在此可以添加其他操作，如蜂鸣器报警
  95   3              }
  96   2          }
  97   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    301    ----
   CONSTANT SIZE    =     36    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4      14
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
